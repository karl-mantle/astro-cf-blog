---
import Base from "~/layouts/Base.astro";
---

<Base
  title="Search"
  description="Search the site to find pages, posts, and other content. Use keywords to locate relevant results."
  loadingOptions={{
    loadPagefind: true,
  }}
>
  <section class="relative mb-4 grid max-w-3xl grid-cols-1 place-content-start gap-4 md:mb-12">
    <h1 class="text-2xl font-medium md:text-3xl">Search this site</h1>
    <div id="search" class="w-full"></div>
  </section>
</Base>

<script>
  // eslint-disable-next-line @typescript-eslint/ban-ts-comment
  // @ts-nocheck
  function initSearch() {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const searchString = urlParams.get("q");

    const pagefind = new PagefindUI({
      element: "#search",
      debounceTimeoutMs: 500,
      showEmptyFilters: false,
      excerptLength: 15,
      showImages: false,
      addStyles: false,
      autofocus: true,
      pageSize: 10,
      processResult: function (result) {
        result.url = result.url.replace(/\/$/, "");
        return result;
      },
    });
    if (searchString) {
      pagefind.triggerSearch(searchString);
    }
  }
  document.addEventListener("DOMContentLoaded", initSearch);
  document.addEventListener("astro:after-swap", initSearch);
</script>

<style is:global>
  @reference "~/styles/global.css";

  .pagefind-ui__form {
    @apply flex flex-col gap-2;
  }

  .pagefind-ui__search-input {
    @apply border-mikado-500 focus:text-mikado-950 focus:bg-mikado-100/25 ring-mikado-500 placeholder:text-mikado-900 hover:placeholder:text-mikado-950 border bg-transparent p-4;
  }

  .pagefind-ui__search-clear {
    @apply hover:border-mikado-950 focus-visible:bg-mikado-300 hover:text-mikado-950 absolute top-18 right-6 w-fit cursor-pointer border-b border-transparent text-sm focus:border-b-2 focus-visible:border-black focus-visible:p-1 focus-visible:text-black;
  }

  .pagefind-ui__message {
    @apply font-medium;
  }

  .pagefind-ui__drawer {
    @apply h-full overflow-y-auto;
  }

  .pagefind-ui__result {
    @apply border-mikado-500 my-4 border-b;
  }

  .pagefind-ui__result mark {
    @apply bg-mikado-300;
  }

  .pagefind-ui__result-link {
    @apply hover:text-mikado-950 focus-visible:bg-mikado-300 font-semibold underline-offset-4 hover:underline focus:decoration-2 focus-visible:p-1 focus-visible:text-black;
  }

  .pagefind-ui__result-title {
    @apply mb-2;
  }

  .pagefind-ui__result-inner {
    @apply my-2;
  }

  .pagefind-ui__button {
    @apply border-mikado-500 focus-visible:bg-mikado-300 hover:bg-mikado-100/25 hover:border-mikado-950 hover:text-mikado-950 mr-auto flex cursor-pointer items-center justify-center border bg-transparent p-2 px-4 transition duration-300 hover:border-2 focus-visible:border-black focus-visible:text-black;
  }
</style>
