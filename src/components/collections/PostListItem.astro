---
import type { HTMLAttributes } from 'astro/types';
import type { RenderedContent } from 'astro:content';
import { Picture } from 'astro:assets';
import { slugify } from '~/utils/collections';
import truncate from 'truncate-html';
import Button from '~/components/ui/Button.astro';
import Date from '~/components/ui/Date.astro';

interface Props extends HTMLAttributes<'li'> {
  category: string,
  content?: RenderedContent,
  date: Date,
  heading: string,
  href: string,
  image?: {
    alt: string | null,
    src: ImageMetadata
  }
};

const { category, content, date, heading, href, image }: Props = Astro.props;
---

<li class="flex flex-col gap-2">

  { image && (
    <Picture
      src={image.src as any}
      widths={[480, 960]}
      sizes={`(max-width: 640px) 480px`}
      inferSize
      formats={['webp']}
      loading="lazy"
      class="object-cover aspect-video"
      alt={image.alt ?? ''}
    />
  )}

  <h3 class="block border-b border-mikado-600 py-4 text-3xl font-semibold">{heading}</h3>

  <div class="flex items-center gap-1 text-sm">
    <Date date={date} />
    <span>|</span>
    <Button
      href={`${Astro.site}posts/category/${slugify(category)}`}
      label={category}
    />
  </div>

  <article
    class="prose prose-mikado max-w-none"
    set:html={content ? truncate(content.html, { length: 200, byWords: true }) : '<p>Content not found.</p>'}
  >
  </article>

  <Button
    class="-ml-1 mt-2 font-semibold"
    href={href}
    icon="ri:arrow-right-line"
    iconAnimate={true}
    label="Continue reading"
  />

</li>
