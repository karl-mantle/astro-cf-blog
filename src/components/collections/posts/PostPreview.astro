---
import type { ImageMetadata } from "astro";
import type { HTMLAttributes } from "astro/types";
import type { RenderedContent } from "astro:content";
import { Picture } from "astro:assets";
import { collectionsConfig, imagesConfig } from "~/site.config";
import slugify from "slugify";
import truncate from "truncate-html";
import TextBtn from "~/components/ui/buttons/TextBtn.astro";
import Date from "~/components/ui/Date.astro";

interface Props extends HTMLAttributes<"li"> {
  category: string;
  content?: RenderedContent;
  date: Date;
  heading: string;
  href: string;
  image?: {
    alt: string | null;
    src: ImageMetadata;
  };
  loading?: "eager" | "lazy";
}

const { category, content, date, heading, href, image, loading }: Props = Astro.props;
---

<li class="flex flex-col gap-2">
  {
    image && (
      <Picture
        alt={image.alt ?? ""}
        class="aspect-video object-cover"
        format="webp"
        loading={loading ?? "lazy"}
        sizes={imagesConfig.half.sizes}
        src={image.src}
        widths={imagesConfig.half.widths}
      />
    )
  }

  <h3 class="border-mikado-500 border-b py-4">{heading}</h3>

  <div class="flex items-baseline gap-1 text-sm font-medium">
    <Date class="self-center" date={date} />
    <span>|</span>
    <TextBtn
      href={`${collectionsConfig.permalink_posts_category}${slugify(category, { lower: true })}`}
      label={category}
    />
  </div>

  <article
    class="typography max-w-none"
    set:html={content
      ? truncate(content.html, { length: 200, byWords: true })
      : "<p>Content not found.</p>"}
  />

  <TextBtn
    class="mt-2 -ml-1 font-semibold"
    href={href}
    icon="material-symbols:arrow-right-alt"
    iconAnimate={true}
    label="Continue reading"
    aria-label={`Continue reading: ${heading}`}
  />
</li>
