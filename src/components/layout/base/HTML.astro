---
import type { MarkdownHeading, Page } from "astro";
import type { DataEntryMap } from "astro:content";
import { generalConfig } from "~/site.config";
import { createSchema } from "~/lib/schema";
import Head from "~/components/layout/base/Head.astro";
import HeadEnd from "~/components/measurement/HeadEnd.astro";
import BodyStart from "~/components/measurement/BodyStart.astro";
import SkipToMain from "~/components/ui/a11y/SkipToMain.astro";
import Header from "~/components/layout/header/Header.astro";
import TocButton from "~/components/ui/toc/Button.astro";
import ScrollToTop from "~/components/ui/a11y/ScrollToTop.astro";
import Footer from "~/components/layout/footer/footers/Simple.astro";
import BodyEnd from "~/components/measurement/BodyEnd.astro";

interface Props {
  collection?: keyof DataEntryMap;
  description?: string;
  entry: DataEntryMap[keyof DataEntryMap][string];
  page?: Page;
  tableOfContents?: MarkdownHeading[];
  title?: string;
  type: string;
}

const { collection, description, entry, page, tableOfContents, title, type } = Astro.props;

const url = new URL(Astro.url.pathname, Astro.site);

const schema = createSchema(type, url, entry, page);

const pagefindAttr = collection ? { "data-pagefind-filter": `collection:${collection}` } : {};
---

<!doctype html>
<html lang={generalConfig.language}>
  <Head description={description} entry={entry} title={title}>
    <script is:inline type="application/ld+json" set:html={JSON.stringify(schema)} />
    {type === "searchResultsPage" && <script type="module" src="/pagefind/pagefind-ui.js" />}
    <HeadEnd />
  </Head>

  <body
    class="text-mikado-900 bg-mikado-50 dark:text-mikado-50 dark:bg-mikado-950 grid grid-cols-1 font-serif text-base md:h-screen md:grid-cols-3 md:grid-rows-[auto_1fr_auto] md:overflow-hidden"
    {...pagefindAttr}
  >
    <BodyStart />
    <SkipToMain />
    <Header />
    <main
      id="main"
      class="col-span-2 row-span-3 overflow-y-scroll px-4 pt-8 md:px-8 md:pt-12"
      data-pagefind-body
    >
      {tableOfContents && <TocButton />}
      <slot />
    </main>
    <ScrollToTop />
    <Footer />
    <BodyEnd />
  </body>
</html>
