---
import type { ImageMetadata } from "astro";
import type { HTMLAttributes } from "astro/types";
import { Picture } from "astro:assets";
import { imagesConfig } from "~/site.config";
import "swiper/css";
import "swiper/css/bundle";

interface Props extends HTMLAttributes<"div"> {
  images: {
    alt?: string;
    src: ImageMetadata;
  }[];
  loading?: "eager" | "lazy";
}

const { images, loading, class: className, ...rest }: Props = Astro.props;
---

<div class:list={["swiper not-prose contain mb-4 md:mb-8", className]} {...rest}>
  <div class="swiper-wrapper">
    {
      images.map((item, index) =>
        item ? (
          <div id={`slide-${index + 1}`} class="swiper-slide">
            <Picture
              alt={item.alt ?? ""}
              class="aspect-video object-cover"
              format="webp"
              loading={loading ?? "lazy"}
              sizes={imagesConfig.half.sizes}
              src={item.src}
              widths={imagesConfig.half.widths}
            />
          </div>
        ) : null,
      )
    }
  </div>

  <div class="swiper-pagination"></div>
  <div class="swiper-button-next"></div>
  <div class="swiper-button-prev"></div>
</div>

<script>
  import Swiper from "swiper/bundle";
  import "swiper/css/bundle";

  function initSwiper() {
    const swiperEl = document.querySelector(".swiper");
    if (!swiperEl) return;

    new Swiper(".swiper", {
      slidesPerView: 1,
      spaceBetween: 12,
      loop: true,
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
    });
  }

  document.addEventListener("astro:page-load", initSwiper);
</script>

<style is:global>
  @reference "~/styles/global.css";

  .swiper {
    --swiper-theme-color: #fff;
    --swiper-navigation-size: 27px;
    --swiper-navigation-color: var(--swiper-theme-color);
    --swiper-navigation-disabled-opacity: 0.35;
    --swiper-pagination-bullet-size: 8px;
    --swiper-pagination-bullet-horizontal-gap: 6px;
    --swiper-pagination-color: var(--color-mikado-500);
    --swiper-pagination-bullet-inactive-opacity: 0.3;
    --swiper-pagination-bullet-inactive-scale: 0.8;
    --swiper-scrollbar-drag-size: 50px;
  }

  .swiper-button-next,
  .swiper-button-prev {
  }

  .swiper-pagination {
  }
</style>
